language: c
os: linux
dist: bionic
node_js:
- '14'
services:
- docker
jobs:
  include:
  - os: linux
    dist: bionic
    env:
    - OPENSSL="1.1.0"
    - FIPS=FALSE
  - os: linux
    dist: bionic
    env:
    - OPENSSL="BUILD"
    - FIPS=FALSE
  - os: linux
    dist: bionic
    env:
    - OPENSSL="BUILD"
    - FIPS=TRUE
  - os: osx
    osx_image: xcode12
    env:
    - FIPS=FALSE
  - os: osx
    osx_image: xcode12
    env:
    - FIPS=TRUE
  - os: osx
    osx_image: xcode12
    env:
    - IOS=true
    - FIPS=false
  - os: osx
    osx_image: xcode12
    env:
    - IOS=true
    - FIPS=true
  - os: linux
    dist: bionic
    env:
    - ANDROID=true
  - os: linux
    dist: bionic
    env:
    - ANDROID=true
    - FIPS=true
  - os: linux
    dist: bionic
    env:
    - NODE=true
  - os: linux
    dist: bionic
    env:
    - PHP=true
  - os: linux
    dist: bionic
    if: tag IS present
    env:
    - secure: uy3zElS2T940YqiANjb/iorD5Du9KhC0xwMRYbo5aCBU3gNrpyZrEJL57HtPGk5PifjivobKFyoA1KkFc73xmQyN4uMRQepeLTrXhuRFkjqdYAP7JU1vAmIM31IY2qUkDgDhQnepfaEFRQB4tP6txOTr+bms/YI4TK2TKcLLjr0LjEFsDAKea7l/0ut081/fmwpueQfusgmJtPBKZbuTAmRDjWqIml4L6NSAHkrxQG+PYfaUeX7QTiWB61xIBguwipPh9oXrhRWRP1M/9OvdxxzlbzP6eTBxRjGzWWCk/RK8WIaj1bzoxZZNQYuQxvWPJweP3b8CMR676m66zosAw+WmrAdIpy8ObrGTvOBY1vFJfcsIcvUGyeb8lvmedoKorjPO7pl/sU/7q7J/2PKH4fvjP+9p1rQtfRMk16oqXwj6ETrBEZX0H1GyoyCBlarjk7xol1HFJwIsqj1WadBypkSU8288tHsjyN065/z9rjSTBqJKNtwYxkQpTMKzUv6d08YUUBGCFUsRXtBajybuRzuaOrpOZXcJikOAenm/VYycY1R7vTmtwliyhX9JrJ+UNbkycZ12mOqHmjQi2oWMJhNpmxZTR/cNV+NHTgBAbVI5rzaRrtDdP6B6mE9oltYx4e9w45Z19HpU3+7EkYabzQ05lN0MWjuGZV2omPLSRmo=
    - secure: TedNGI8HsFRWM1/PnaxGb5AyL9pbosXBIIg6b/33+EiDWWocQnTRMIExvUg80yskJLDFPukSG6DNYrhnqmkHPlwqUI7WGT4IBK9EG3IiJqRMXiYI7zgiw+/sKL435jlcu0UzgWphYyOywXlhEKZvozTTeirFQzWvBQHq8Q0H119ENiKNZAL/cFjWTbpCsz+SDk7wFJzWfa62s8NyxNpaJeG3vFetU4hIz6I5Up4J0u6VaRSxs3yOSafYXiFLJg3WyWuTpQbpvkQRzl7Qapu3eLezLeqYeZPE8KlJpQognf3Nv/gFKoewIz4750+Kf0hCuATp6+p5l5YyZv0puP9gs+VSTjXW9kDVETvo+Z4Em+E+kYgx5uqSuNCXrcInP975TEAkZhZW6ZfAwdw3a1CGjJRlDH1jX0Lj0JMI7NNBWTh1/cQSevk2PLM16YBDZr3hQPu7wffNkCq50w/TqPdVcYENf1AntITOx6gLEWb7oXZxl3irrr+HIF6jS16R/HEM8Lqum12fTQghmroLSOWxAq9Nerr5rxHW88ubFVCjZmYysCArpIN2WhtgsBhkWyFsX/ksOdRDYPHOJw5w5VDEB2EijwzMBNQ3XLtY4uqfdWUod3zOhlfnCXWzO7CcFpkEVIcrG4dYMdN3L9WOrfcWgzFyv95MSEZ7P5nAygmIf1U=
    - NODE_DISTRO=true
  - os: osx
    osx_image: xcode11
    env:
    - NODE=true
    - NODE_VER=10
  - os: osx
    osx_image: xcode11
    env:
    - NODE=true
    - NODE_VER=12
  - os: linux
    jdk: oraclejdk8
    env:
    - JAVA=true
    - FIPS=false
  - os: osx
    jdk: oraclejdk8
    osx_image: xcode11
    env:
    - JAVA=true
    - FIPS=false
before_install:
- if [[ "$TRAVIS_OS_NAME" == "linux" && "$OPENSSL" == "BUILD" ]]; then export LOCAL_OPTIONS="-DBUILD_OPENSSL=true";
  fi
- if [[ "${NODE}" == "true" || "${JAVA}" == "true" ]]; then git clone https://github.com/yegorich/swig.git;
  cd swig; git checkout 0ea6a3bdbf3184d230bf17d2c17704dbc2ec7aac; ./autogen.sh; ./configure;
  make -j2 && sudo make install; cd ../; fi
- if [[ "${JAVA}" == "true" ]]; then export LOCAL_OPTIONS="-DBUILLD_JAVA=true"; fi
- if [[ "${IOS}" == "true" ]]; then export LOCAL_OPTIONS="-DCMAKE_TOOLCHAIN_FILE=../Toolchain-iOS.cmake";
  fi
- if [[ "$TRAVIS_OS_NAME" == "osx" && "$NODE" == "true" ]]; then nvm install ${NODE_VER};
  fi
script:
- "export OSSL_SUPPORT_UNAME=${OSSL_SUPPORT_UNAME}; export OSSL_SUPPORT_PASS=${OSSL_SUPPORT_PASS};
  if [[ ! -z \"${ANDROID}\" ]]; then\n  ./build_android_docker.sh\nelif [[ ! -z \"${PHP}\"
  ]]; then\n ./build_php_docker.sh\nelif [[ ! -z \"${NODE}\" ]]; then\n\n  npm install
  --build-from-source\n  npm test\nelif [[ ! -z \"${NODE_DISTRO}\" ]]; then\n  ./build_node_dist.sh\nelse\n
  \ mkdir build && cd build\n  cmake ${LOCAL_OPTIONS} -DCMAKE_BUILD_TYPE=Release -DCMAKE_POSITION_INDEPENDENT_CODE=true
  -DOSSL_SUPPORT_UNAME=${OSSL_SUPPORT_UNAME} -DOSSL_SUPPORT_PASS=${OSSL_SUPPORT_PASS}
  -DFIPS=${FIPS} -DBUILD_TESTS=true ../\n  make \n  if [[ -z \"${IOS}\" ]]; then make
  test; fi\nfi\n"
env:
  global:
  - secure: uQQVoETDHhgEZFg5ORymWXRgXrlVDUibMAOwkVHbcWSQX5Mvts7j29nS7ErQEriRhPKm+9MrbVoNXSihOUsZQ5dPz7I0PXRw9LHNtzr3PMZBXuqQgtScsdofiB3j931xCLx9QGSjSKWP4AlcdBzirjQvIBYPC7r+X3or3+krW6uKm3kdwhdjJxxLaUROumV7YD8vlgOQFkYnYJ/eQlA1PG2bE2OA3kzfUwvbW1p6D3DU0Iqcf9mBVJltMjX184hp4ciWwt3urt+L5OC+xUwTvXhjoe/CYX8e9ZIOCbUZQeyMOvNDVG8C2z+9hlQf1Xt9iZI7cj55Wct+3mjnafbZ6NfU6wkqx+tp8hKm0cTSUZUpqf040vJjFREgiiDrnEj/WJo+pfSzHTBpQx8PAB0BdExT9PkFefnqnaD7WxTtBnCX5O/bYMRDTw/vkwaSCIkBjE+wiu68x7vQJhg6p/arkxGzBejGzDKJPENRcThqTHGr3RdV8I8D8uo+7J1+LrI817gwJHDHfCYYlwVKjY0jAkZbwOhO3Kucks4PZPX1KytY+5J/DDMqpbjOxjWWihSORiGoCPj699XQa0HA3GXgEkDkBTXKx/rFsE29RGfNkLwh/zLouYO0/d18A6PlhpjobL6hqGqYJr/nAznO1XvmDNVoVxg+jkP1SaerDzatKcw=
  - secure: bwpPUblZCXWUCQ4Az4OReqWF9M+XzDRsqgsh8niLN4F4ovmCtyFl8S0/gspyBMgvxdbSwHVJsT+/i8a9tA0mSy4BI8jGJg75ogBBoGwg9VCr3EDi4eWrsBNAZ16loz0Curyt0jrvw9Lu58uywb4CYv/fTYi2TS1Fat/Fm/ep9nR9vn/ngW6L1PJELYmhbaOW5BiVkabjeHGF8MK3p8e8XAThnPdiIRjtbJtXW4XFsqzN8TN4qcnyQ38IFGFBl1BYY3oZLYI28DXxngRc4tyOULgfTCi9J8yDG0cpW2tb0KIFbYauIy+tvDmLVyN0oY3s5iFl73SXT9bicO5T3NS4zofqZ4nbMpmQ4YrhIMpQ2z7MVDfIt1KXkP/LPiSTUGCE4/h6jU3zyS2CVpzU2YdTm1ikOjNaicdPFp88/7HCHvVSZAAQUG6avfU3XIAhyyn5KVDFdxlAgGv4TluCQB01ytGSmYYgWscJGsxMiGQ6GawgsVCcHFr4JyznLxqFslowgw0cnJ4g8RKnoXpa+NTDi7q0orQIavhYU/mvoa5uPVDwj+0fYTcKru9CdqwgHjKReFBoqd8cJbxkNLhDhqYZma60BQPWshUF/vR5LoP4KwspTsdhDnzi4+YxRIHXvqve4HWWVkKjm+Z6DvX46s3Vt4HI6ZFeKKmUnhITuhKKV3o=
